## 本地存储和服务器存储

本地存储：把一些信息存储到客户端本地（目的有很多，其中有一个就是实现多页面之间的信息共享）

- 离线缓存（xxx.manifest：H5处理一些缓存还是存在些硬伤的，所以真实项目中一般还是传统的native app来完成这件事情
- localStorage / sessionStorage：H5新增的API，基于这个API可以把一些数据缓存到客户端本地（常用）
- IndexedDB / webSQL：本地数据库存储
- Cookie：本地信息存储（常用）
- CacheStorage / ApplicationCache：本地缓存存储
- ...

用到本地存储的地方：

【页面之间信息的通信】

A存信息，B页面中也可以获取。

比如说登录、记住用户名密码（或者自动登录）、购物车、跳转到其他页面，返回上级页面的时候停留在最后一次点击的位置……

----

图

需求一：A页面中有一个列表，点击列表中的每一项，跳转到B页面（详情页面），在B页面需要知道点击的是A中的哪条数据，从而展示不同的信息

方案一：URL问号传参’B.html?xxx=xxx‘（进入到B页面，首先把传递的参数获取到，根据传递的不同，我们从服务器端获取不同的数据，从而展示不同的内容）

前提：需要的是A中的某个操作可以跳转到B页面，此时才可以问号传参

本地存储都是存储到当前浏览器的指定的地方

- 在谷歌浏览器中存储的信息，在IE浏览器获取不到，本地存储无法跨浏览器进行传输。

存储的信息是按照域来管理的

- 访问京东网站，把信息都存储到jd.com中，其他域的网站是无法直接获取这些信息的。本地存储不能直接跨域访问

----

图

登录/注册：真实项目中的登录注册，是基于session服务器存储的登录信息，而不是本地存储（因为本地存储不安全：明文存储，直接在浏览器的控制台中就可以查看到）

session和cookie的关联：

- session是服务器存储，cookie客户端存储

- 在服务器端建立session之后，服务器和当前客户端之间会建立一个唯一的标识（sessionID/sid），而本次存储的session信息都存放到对应的sid下（目的是为了区分不同客户端都在服务器上建立session信息，后期查找的时候，可以找到自己当初建立的）

- 当服务器端把一些成功或者失败的结果返回给客户端的时候，在响应头信息会增加set-cookie（客户端的cookie）这样的字段，把connect-sid存储到客户端的cookie信息中。HttpOnly规定当前的cookie信息只能获取使用，但是不能修改

  set-cookie:connect-sid=xxxxxx

- 当客户端在向发送任何请求的时候，在请求头中，都会把cookie信息带上，传递给了服务器（包含之前存储的connet-sid信息）

  Cookie:...;connect-sid=xxxxxx

-----

购物车

图-登录

图-没登录

【做一些性能优化】

把一些不经常改变的数据，在第一次从服务器端获取到之后，存储到客户端本地（记录一个存储时间），假设我们设置有效存储期是10分钟，那么10分钟以内，我们再刷新页面，就不用再向服务器发请求了，直接从本地数据中获取展示即可 

- 减轻服务器压力
- 对于不经常更新的数据我们可以把存储周期设置的长一些，有助于页面第二次加载的时候，渲染的速度（移动端常用）

## localStorage VS cookie

### cookie

1. 兼容所有的浏览器
2. 有存储的大小限制，一般一个源（一个域下），只能存储4kb内容
3. cookie有过期时间（当然我们自己可以手动设置这个时间）
4. 杀毒软件或者浏览器的垃圾清理都可能会把cookie信息强制清除掉
5. 在隐私或者无痕浏览模式下，是不记录cookie的
6. cookie不是严格的本地存储，因为要和服务器之间来回传输

### localStorage

1. 不兼容IE8及以下低版本
2. 也有存储的大小限制，一个源下最多只能存储5MB左右
3. 本地永久存储，只要不手动删除，永远存储在本地（但是我们可以基于API removeItem/clear手动清除一些自己想要删除的信息）
4. 杀毒软件或者浏览器的垃圾清理暂时不会清除localStorage（发现新版本谷歌会清除localStorage）
5. 在隐私或者无痕浏览模式下，是会记录localStorage的
6. localStorage和服务器没有半毛钱关系

真实项目中使用本地存储来完成一些需求的情况不是很多，一般都是基于服务器的session或者数据库存储完成的（服务器的session和本地的cookie是有关联的），如果不考虑兼容，就是想基于本地存储来完成一些事情，那么一般都是用localStorage的（尤其是移动端开发制作）

```:confetti_ball:
localStorage.setItem([key],[value]):
[value]必须是字符串格式，即使写的不是字符串，也会默认转换为字符串
localStorage.getItem([key],[value]):通过属性名获取存储的信息
localStorage.removeItem([key]):删除指定的存储信息
localStorage.clear():清除当前域下存储的所有信息
localStorage.key(0):基于索引获取指定的key名称
...
```

```
document.cookie=''; 设置cookie
```

